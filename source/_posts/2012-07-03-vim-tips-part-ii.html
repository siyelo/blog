---
layout: post
title: "Vim Tips - Part II"
date: 2012-07-03 14:39:23
comments: true
categories:
author: 
---


    <p>This week we'll share few more userful Vim tips that we've learned recently, most of them from the&nbsp;<a href="http://pragprog.com/book/dnvim/practical-vim" title="Practical Vim Book">Practical Vim</a> book. You can also read the first part in this series&nbsp;<a href="http://blog.siyelo.com/vim-tips-part-i" title="Vim Tips - Part I">Vim Tips - Part I</a> at our blog.</p>
<p><span style="font-size:medium;">1. Replace in multiple files</span></p>
<p>To search &amp; replace in multiple files, we need to create list of files in which we'll execute a command. We do that by using the&nbsp;<strong>:args</strong> command. For example, lets load all javascript files that start with the "hrt" string:</p>
<div class="CodeRay">
  <div class="code"><pre>:args app/assets/javascripts/hrt*.js</pre></div>
</div>

<p>We can see which files are loaded in the arguments list by running only the <strong>:args</strong> command:</p>
<div class="CodeRay">
  <div class="code"><pre>:args</pre></div>
</div>

<p>Having the arguments list prepared, we can execute search &amp; replace with:</p>
<div class="CodeRay">
  <div class="code"><pre>:argdo %s/Hrt/Hrt2/g</pre></div>
</div>

<p>Once changes have been made in the files, we can save all the files in arguments list with:</p>
<div class="CodeRay">
  <div class="code"><pre>:argdo update</pre></div>
</div>

<p><span style="font-size:medium;">2. Search and replace in&nbsp;</span><span style="font-size:medium;">multiple&nbsp;</span><span style="font-size:medium;">files</span></p>
<p>Previous tip works OK if we know the files where we want to run the replace command. Most common need is to search for a string in files, and then run the replace command only in those files. We can do that by using <strong>vimgrep</strong> command to find a pattern in files. <strong>vimgrep</strong>&nbsp;command creates quicklist with files matching the pattern which list we can see by opening it with&nbsp;<strong>:copen</strong> command. If we want quicklist to be useful, we need to convert it to arguments list by using the&nbsp;<strong>:Qargs</strong>&nbsp;mapping&nbsp;which we have in our vimrc file:</p>
<div class="CodeRay">
  <div class="code"><pre>command! -nargs=0 -bar Qargs execute 'args' QuickfixFilenames()

&quot; populate the argument list with each of the files named in the quickfix list
function! QuickfixFilenames()
  let buffer_numbers = {}
  for quickfix_item in getqflist()
    let buffer_numbers[quickfix_item['bufnr']] = bufname(quickfix_item['bufnr'])
  endfor
  return join(map(values(buffer_numbers), 'fnameescape(v:val)'))
endfunction</pre></div>
</div>

<div>Finally, here's an example of what needs to be run to do search &amp; replace in files:</div>
<div>
<div>
<div class="CodeRay">
  <div class="code"><pre>:vimgrep /CurrencyNumberHelper/ app/models/*.rb
:Qargs
:argdo %s/CurrencyNumberHelper/CurrencyHelper/g
:argdo update</pre></div>
</div>

</div>
<p />
<div><span style="font-size:medium;">3. Edit already recorded macro</span></div>
<br />While recording a macro it's easy to do mistakes. And when that happens, it's easier to edit the already recorded macro than to re-record it. Lets say we have recorded new macro in register <strong>a</strong>. We can print the content of the macro in the current buffer using <strong>:put a</strong> and then edit the macro in Vim. Once macro is changed, we can select it and then yank it to register a with&nbsp;<strong>"ay</strong>. Then we are ready to execute the new macro from register a with <strong>@a</strong>.
<p />
<div><span style="font-size:medium;">4. Execute macro in multiple files</span></div>
<div><br />We have&nbsp;already&nbsp;recorded a macro and we want to run it in few files. First we build arguments list with the files, for example let's load all models from a Rails app:</div>
<div>
<div class="CodeRay">
  <div class="code"><pre>:args app/models/*.rb</pre></div>
</div>

</div>
<div>&nbsp;Then we run the macro (that is recorded in register a) with:</div>
<div>
<div class="CodeRay">
  <div class="code"><pre>:argdo normal @a</pre></div>
</div>

</div>
<div>In the end we save all the buffers with:</div>
<div>
<div class="CodeRay">
  <div class="code"><pre>:argdo update</pre></div>
</div>

</div>
<p />
<div><span style="font-size:medium;">5.&nbsp;Delete commands</span></div>
<br />We can run the following command in <strong>Insert mode</strong>, <strong>Vim Command Line mode</strong> or <strong>Shell Command Line</strong>:
<div class="CodeRay">
  <div class="code"><pre>&lt;C-h&gt; &quot; delete back one character (backspace)
&lt;C-w&gt; &quot; delete back one word
&lt;C-u&gt; &quot; delete back to start of line</pre></div>
</div>

<p><span style="font-size:medium;">6. Vi mode on command line</span></p>
<div>Bash shell provides two modes for command line editing - <strong>emacs</strong> and <strong>vi</strong>. Emacs editing mode is the default one, and we can change it to vi mode using:</div>
<div>
<div class="CodeRay">
  <div class="code"><pre>set -o vi</pre></div>
</div>

<div>Then while on command line, we can press <strong>ESC</strong> to go to vi editing mode and use Vim's single line editing capabilities. While in normal Vim mode on command line, we can press <strong>v</strong> that will popup editor where we can edit and save buffer that will be executed on command line.</div>
<p />
<div>To go back to emacs mode, we need to type:</div>
</div>
</div>
<div class="CodeRay">
  <div class="code"><pre>set -o emacs</pre></div>
</div>

<p>If you want to learn more about which Vim commands you can run in bash shell vi mode, here's&nbsp;<a href="http://www.catonmat.net/download/bash-vi-editing-mode-cheat-sheet.txt" title="Vi editing mode cheatsheet">cheatsheet</a> for that.</p>
  
