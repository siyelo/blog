
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Rails Deployment Audit - My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="We recently undertook an audit of a Rails deployment for a system developed by&nbsp;Red Comet Labs. It is a Rails 3.2 application that integrates &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yoursite.com/rails-deployment-audit">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:yoursite.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Rails Deployment Audit</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-13T14:13:00+00:00" pubdate data-updated="true">Jul 13<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content">    <p>We recently undertook an audit of a Rails deployment for a system  developed by&nbsp;<a href="http://www.redcometlabs.com/" title="Red Comet Labs">Red Comet Labs</a>. It is a Rails 3.2 application that  integrates with 3 different storage systems (CouchDB, PostgreSQL and  Redis). It is deployed using Capistrano and the server setup and  management is done using Chef.</p>
<p>We shared our Rails Deployment experience with Red Comet Labs, and in  this article we&#8217;ll discuss a checklist of some&nbsp;<a href="http://www.jedi.be/blog/2010/02/12/what-is-this-devops-thing-anyway/" title="What is this devops thing anyway?">devops</a>&nbsp;practices and  tools we are familiar with.</p>
<p><span style="font-size:medium;">Extract sensitive data</span></p>
<p>All sensitive data like passwords, API keys &amp;  tokens that are in the application are extracted as environment  variables outside of the source code repository. We are using&nbsp;<a href="https://github.com/sstephenson/rbenv" title="rbenv">rbevn</a>&nbsp;for  managing rubies, there is a nice plugin for setting up environment  variables <a href="https://github.com/sstephenson/rbenv-vars" title="rbenv vars">rbenv-vars</a>.</p>
<p><span style="font-size:medium;">Continuous Integration &amp; Deployment</span></p>
<p>There are many great open source and commercial tools out there for&nbsp;<a href="https://www.ruby-toolbox.com/categories/continuous_integration" title="Continuous Integration tools">Continuous Integration</a>. We are using&nbsp;<a href="http://jenkins-ci.org/" title="Jenkins">Jenkins CI</a>&nbsp;to run our test suite  and handle Continuous Deployment (if the tests are green) for our  staging branch. For production releases, we suggest doing releases  manually at a scheduled time with the whole team ready and available.</p>
<p><span style="font-size:medium;">Deployment tools</span></p>
<p>If you need more advanced tool for doing the deploy,&nbsp;<a href="https://github.com/capistrano/capistrano" title="Capistrano deployment tool">Capistrano</a>&nbsp;is the definitely the tool to go with. However, if you want  something more light-weight you can try&nbsp;<a href="https://github.com/brentd/gitploy" title="Gitploy deployment tool">gitploy</a>&nbsp;(bare minimum,  git-based tool for deployment). Alternatively, check out another tool  from this&nbsp;<a href="https://www.ruby-toolbox.com/categories/deployment_automation" title="Deployment Automation">list</a>.</p>
<p><span style="font-size:medium;">Deployment Documentation</span></p>
<p>Document server setup and everything about the deployment process.  It may seem tedious now but in the long-run it will help because setups  are easily forgetten and the person who initially setup the server is  not always on hand to assist. By using an automation tool like&nbsp;<a href="http://wiki.opscode.com/display/chef/" title="Chef">Chef</a>&nbsp;or&nbsp;<a href="http://puppetlabs.com/" title="Puppet">Puppet</a>&nbsp;you are kind of documenting things on the fly.</p>
<p><span style="font-size:medium;">Server security</span></p>
<p>Don&#8217;t use your root user when you access your server - it&#8217;s the simplest  way to prevent accidentally breaking things. Create another user that  can execute superuser commands using sudo. Use this non-root user all  the time. You should use SSH key authentication to protect your server  against brute-force password cracking attacks. Furthermore, you should  disable SSH password authentication and the ability to login as root.  Read more on this in Linode&#8217;s guide on how to&nbsp;<a href="http://library.linode.com/securing-your-server" title="Securing your server">secure your server</a>.</p>
<p><span style="font-size:medium;">Start clean on boot</span></p>
<p>All the services that are being used by the application need to start  cleanly when the server boots up - there should be no need for manual  intervention. If you are deploying to Ubuntu,&nbsp;<a href="http://manpages.ubuntu.com/manpages/precise/man8/update-rc.d.8.html" title="update-rc.d">update-rc.d</a>&nbsp;can be used for init.d processes.&nbsp;And, for the application Procfile-based processes you can use the&nbsp;<a href="https://github.com/ddollar/foreman" title="foreman gem">foreman gem</a>&nbsp;and there is an easy&nbsp;<a href="http://michaelvanrooijen.com/articles/2011/06/08-managing-and-monitoring-your-ruby-application-with-foreman-and-upstart/" title="foreman export to upstart">export to  upstart</a>&nbsp;for monitoring and boot start up setup.</p>
<p><span style="font-size:medium;">Log files</span></p>
<p>Prevent log files from growing to the point where you don&#8217;t have any  space left on disc device by using&nbsp;<a href="http://www.nullislove.com/2007/09/10/rotating-rails-log-files/" title="logrotate">logrotate</a>. Analyze request log of  your Rails application to produce a performance report with&nbsp;<a href="https://github.com/wvanbergen/request-log-analyzer" title="request-log-analyzer gem">request-log-analyzer</a>.</p>
<p><span style="font-size:medium;">Cron jobs</span></p>
<p>Whether it&#8217;s a backup script or background task that needs to be  run as a job, it&#8217;s a good idea to have documentation on it within the  application. Cron&#8217;s scheduling format is often&nbsp;difficult to read so we suggest using the&nbsp;<a href="https://github.com/javan/whenever/" title="whenever gem">whenever gem</a>&nbsp;to make it more readable.</p>
<p><span style="font-size:medium;">Backups</span></p>
<p>For both database &amp; uploaded content (like images and documents) we need to have regular backups distributed in different physical or cloud locations, <a href="https://github.com/meskyanichi/backup" title="backup gem">backup gem</a> is very handy tool for that.</p>
<p><span style="font-size:medium;">Failover</span></p>
<p>If server crashes, can you fail over to another server? How much time do you need for that operation and have you tested the procedure before it actually happens? Hosting services offer&nbsp;daily/weekly/monthly&nbsp;<a href="http://www.linode.com/backups/" title="Linode backups">node backups</a> but the procedure need to be tested before there is a need for doing that.</p>
<p><span style="font-size:medium;">External monitoring tools</span></p>
<p>Service like <a href="http://www.pingdom.com/" title="Pingdom monitoring">Pingdom</a> or <a href="http://www.alertra.com/" title="Alerta monitoring">Alerta</a> are interesting for monitoring server uptime and performance and they can send email, text and twitter alerts when the server is not working.</p>
<p><span style="font-size:medium;">Notifications for Exceptions</span></p>
<p>Setup exception notifications to receive email notifications when application crashes. You can use <a href="https://github.com/smartinez87/exception_notification" title="exception_notification gem">exception_notification gem</a> or some paid service like <a href="http://airbrake.io/" title="Airbrake exception notifications">Airbrake</a> or <a href="http://www.exceptional.io/" title="Exceptional exception notifications">Exceptional</a>.</p>
<p><span style="font-size:medium;">Process monitoring tools</span></p>
<p>Monitor your DB server, web server &amp; background processes and restart them if they consume too much memory.&nbsp;Tools like <a href="http://upstart.ubuntu.com/" title="Upstart process monitoring tool">Upstart</a>,&nbsp;<a href="https://github.com/arya/bluepill" title="Bluepill monitor">Bluepill</a>, <a href="http://pathfindersoftware.com/2010/09/monitoring-rails-processes-apache-passenger-delayed_job-using-god-and-capistrano/" title="God monitor">God</a>&nbsp;and <a href="http://viktorpetersson.com/2010/07/09/setting-up-monit-to-monitor-apache-and-postgresql-on-ubuntu/" title="Monit monitor">Monit</a>&nbsp;are useful.</p>
<p><span style="font-size:medium;">Server performance</span></p>
<p>Monitor server performance with <a href="http://library.linode.com/linux-tools/common-commands/vmstat" title="vmstat server performance">vmstat</a> or some 3rd party tool like <a href="https://scoutapp.com/" title="Server performance monitor">scoutapp</a>.</p>
<p><span style="font-size:medium;">Application performance</span></p>
<p>Monitor your application performance, uptime, slow DB&nbsp;queries, background tasks with <a href="http://newrelic.com/" title="New Relic">New Relic</a>. They also have <a href="http://newrelic.com/features/availability-monitoring" title="Availability monitoring">Availability monitoring</a> if you don&#8217;t want to use other service for checking that your server is up and running.</p>
<p>The list is long, but it takes lots of patience in understanding the software business and delivering great software.</p>
  
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Your Name</span></span>

      








  


<time datetime="2012-07-13T14:13:00+00:00" pubdate data-updated="true">Jul 13<span>th</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://yoursite.com/rails-deployment-audit" data-via="" data-counturl="http://yoursite.com/rails-deployment-audit" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/vim-tips-part-ii" title="Previous Post: Vim Tips - Part II">&laquo; Vim Tips - Part II</a>
      
      
        <a class="basic-alignment right" href="/scratching-an-itch" title="Next Post: Scratching an itch">Scratching an itch &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/siyelo-drinkup-skopje">Siyelo Drinkup: Skopje</a>
      </li>
    
      <li class="post">
        <a href="/were-hiring-experienced-web-developer">We're Hiring - Experienced Web Developer</a>
      </li>
    
      <li class="post">
        <a href="/scratching-an-itch">Scratching an itch</a>
      </li>
    
      <li class="post">
        <a href="/rails-deployment-audit">Rails Deployment Audit</a>
      </li>
    
      <li class="post">
        <a href="/vim-tips-part-ii">Vim Tips - Part II</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
